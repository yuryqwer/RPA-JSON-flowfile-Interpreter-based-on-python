# RPA-JSON-flowfile-Interpreter-based-on-python

RPA软件在前端（设计器）通过组件拖拽的方式生成流程的标记语言：
* Uipath生成类似xml格式的后缀为.xmal的标记语言
* 艺赛旗IS-RPA生成json格式的后缀为.seq和.ren的标记语言

之后后台服务会将标记语言编译为某种特定的代码文件，比如艺赛旗IS-RPA会利用python解释器将其编译为python脚本文件，再调用python解释器运行生成的python脚本文件。

本项目的目标是设计一种新的架构，能够免去将标记语言编译为代码文件这一过程，直接由解释器解析标记语言并运行。

首先明确一些概念：
* 【流程】运行后能够完成特定自动化任务的文件
* 【组件】RPA流程中的最小执行单元，由一个个具有各种功能模块的组件相互连接构成了流程
* 【容器】用于存放组件并确定组件的运行顺序

## 2020/4/2
开始项目的初步设计，以某一种容器可以保存一系列按顺序运行的组件为基础，把这种容器称为序列（Sequence）。

设想中的序列也可以作为组件进行嵌套使用，因此首先设计了组件的几个基本参数：
* 组件信息字典，对应组件的JSON文本
* 是否跳过该组件，设置为跳过后将直接运行下一个组件
* 组件对应类名，一个组件可能是某个对应的大类下面的某个函数，比如鼠标单击就是鼠标大类下面的一个函数
* 组件对应函数名
* 组件输入参数
* 组件是否处于容器内
* 组件运行的规则

根据这些参数，完成了[组件基类](https://github.com/yuryqwer/RPA-JSON-flowfile-Interpreter-based-on-python/blob/master/componentbase.py)的设计，所有组件都继承该类，并定义自己的运行规则。

接下来是序列的设计，同样也继承自组件基类，但是又有所区别。首先运行规则不是某种特定的写法，仅仅只是按顺序运行容器内的各个组件。其次，容器承担了作用域的职责，需要为自己的组件提供所需的上下文环境，因此提供了variables属性来保存这些信息。这边的variables在序列处于最外层时只是个普通的字典；在嵌套容器中时，由于要能访问所属容器的环境，同时也要保存自己的环境，因此使用ChainMap将其组合起来。最后，用components属性来按顺序保存自己的每一个组件。

为了能让这个项目初步运行起来，还需要完成组件的设计。首先设计了一个最简单的用于输出的组件，它的作用是在所属容器的variables中查找对应的变量并把值打印出来。之后，在Sequence.py中读取JSON文件便能看到解释器输出结果了。

赋值组件是用于改变容器中变量信息的，在容器变量信息为普通字典时，直接更新即可；如果是ChainMap对象，则需要从最初始的容器变量依次搜索并更新。

## 2020/4/3
对于容器内组件很多的情况时，一下子将所有的组件都实例化会占用大量的内存，因此考虑用生成器替换原来的列表。暂时使用eval函数对实例字符串进行求值作为生成器每次迭代的规则，由于生成器每次迭代时局部作用域都为空，需要将容器实例先保存下来再作为locals字典传入。后续如果导致运算过慢时可以考虑使用字典将每个类的字符串名称和类本身关联起来，直接调用字典进行组件实例的创建。

## 2020/4/4
* 新增判断分支组件。
* 修改输出组件，现在除了可以输出变量的值，也可以输出对象的值。

## 2020/4/5
修改赋值组件，现在给未定义的变量赋值时会首先在当前容器内新建变量。
